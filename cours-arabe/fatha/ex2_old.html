<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Exercice Fatha</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

<style>

body{
  margin:0;
  font-family:Arial, sans-serif;
  text-align:center;
  background:#fff;
}

/* Fond */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:url("../../assets/images/islam-bg.jpg") no-repeat center/cover;
  opacity:0.15;
  z-index:-1;
}

/* Bandeau */
.band{
  background:#000;
  color:white;
  max-width:700px;
  margin:25px auto;
  padding:20px;
  border-radius:15px;

  display:grid;
  grid-template-columns:1fr 60px;
  align-items:center;
}

/* Lettres */
.letters{
  display:flex;
  justify-content:center;
  gap:20px;
  direction:rtl;
}

.letter{
  position:relative;
  font-family:"Amiri", serif;
  font-size:55px;
  width:45px;
  height:65px;
  display:flex;
  justify-content:center;
  align-items:center;
}

.base{
  z-index:2;
}

.haraka{
  position:absolute;
  top:-10px;
  font-size:30px;
}

.letter.active{
  background:#ffeaa7;
  color:black;
  font-weight:bold;
}

/* Bouton */
.play{
  background:transparent;
  border:2px solid white;
  color:white;
  border-radius:8px;
  font-size:18px;
  cursor:pointer;
}

/* Navigation */

.nav-ex{
  display:flex;
  justify-content:center;
  gap:18px;
  margin:25px;
}

.nav-arrow{
  background:#000;
  color:white;
  padding:10px 18px;
  border-radius:10px;
  font-size:26px;
  text-decoration:none;
  font-weight:bold;
}

.nav-title{
  font-size:20px;
  font-weight:bold;
}

.nav-top{
  display:flex;
  justify-content:space-between;
  padding:15px 20px;
}

.back-btn,
.home-btn{
  background:#000;
  color:white;
  padding:8px 16px;
  border-radius:10px;
  text-decoration:none;
  font-weight:bold;
}

</style>
</head>

<body>

<!-- NAV TOP -->
<div class="nav-top">

  <a href="index.html" class="back-btn">‚¨Ö Fatha</a>

  <a href="../../index.html" class="home-btn">üè† Accueil</a>

</div>

<!-- NAV EXO -->
<div class="nav-ex">

  <a href="ex1.html" class="nav-arrow">‚ùÆ</a>

  <span class="nav-title">üìù Exercice 2</span>

  <a href="ex3.html" class="nav-arrow">‚ùØ</a>

</div>


<!-- ===== BANDEAU 1 ===== -->

<div class="band">
  <div class="letters" id="band1"></div>
  <button class="play" onclick="togglePlay('band1', this)">‚ñ∂</button>
</div>


<!-- ===== BANDEAU 2 ===== -->

<div class="band">
  <div class="letters" id="band2"></div>
  <button class="play" onclick="togglePlay('band2', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 3 ===== -->
<div class="band">
  <div class="letters" id="band3"></div>
  <button class="play" onclick="togglePlay('band3', this)">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 4 ===== -->
<div class="band">
  <div class="letters" id="band4"></div>
 <button class="play" onclick="togglePlay('band4', this)">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 5 ===== -->
<div class="band">
  <div class="letters" id="band5"></div>
  <button class="play" onclick="togglePlay('band5', this)">‚ñ∂</button>
</div>

<!-- ===== BANDEAU 6 ===== -->
<div class="band">
  <div class="letters" id="band6"></div>
<button class="play" onclick="togglePlay('band6', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 7 ===== -->
<div class="band">
  <div class="letters" id="band7"></div>
<button class="play" onclick="togglePlay('band7', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 8 ===== -->
<div class="band">
  <div class="letters" id="band8"></div>
  <button class="play" onclick="togglePlay('band8', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 9 ===== -->
<div class="band">
  <div class="letters" id="band9"></div>
  <button class="play" onclick="togglePlay('band9', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 10 ===== -->
<div class="band">
  <div class="letters" id="band10"></div>
  <button class="play" onclick="togglePlay('band10', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 11 ===== -->
<div class="band">
  <div class="letters" id="band11"></div>
  <button class="play" onclick="togglePlay('band11', this)">‚ñ∂</button>
</div>
<!-- ===== BANDEAU 12 ===== -->
<div class="band">
  <div class="letters" id="band12"></div>
 <button class="play" onclick="togglePlay('band12', this)">‚ñ∂</button>
</div>

<script>

/* AUDIO */

const audio = new Audio("../../assets/audio/fatha.mp3");

let timer = null;
let isPlaying = false;
let currentButton = null;


/* SONS */

const sounds = {
  "ÿß": { start:0.8, d:0.8 },
  "ÿ®": { start:1.6, d:0.8 },
  "ÿ™": { start:2.4, d:0.8 },
  "ÿ´": { start:3.2, d:1.0 }
};


/* DATA */

/* Ordre p√©dagogique (logique) */
const band1Data = ["ÿ´","ÿ™"];

const band2Data = [
 "ÿ´","ÿ™","ÿ™","ÿ´","ÿ™","ÿ´","ÿ´","ÿ™","ÿ´","ÿ™"
];
const band3Data = ["ÿ®","ÿ®","ÿ™", "ÿ´","ÿ´","ÿ®","ÿ™","ÿ®","ÿ´"
];
const band4Data = ["ÿ®","ÿ®","ÿ™", "ÿ™","ÿ™","ÿ®","ÿ´","ÿ´","ÿß"
];
const band5Data = ["ÿ´","ÿ´","ÿ®","ÿ´","ÿ´","ÿß","ÿ™","ÿ®","ÿ´"
];
const band6Data = ["ÿ™","ÿ™","ÿ®","ÿ´","ÿ´","ÿ®","ÿ®","ÿ®","ÿ™" 
];
const band7Data = ["ÿ´","ÿ´","ÿß","ÿ®","ÿ®","ÿ™","ÿ™","ÿ™","ÿ®"
];
const band8Data = ["ÿ™","ÿ®","ÿ´","ÿ®","ÿ®","ÿ™","ÿ´","ÿ´","ÿ®"
];
const band9Data = ["ÿ®","ÿ®","ÿ™","ÿ™","ÿ™","ÿ®","ÿ™","ÿ®","ÿ´"
];
const band10Data = ["ÿ®","ÿ®","ÿ™","ÿ´","ÿ´","ÿ®","ÿ´","ÿ´","ÿß"
];
const band11Data = ["ÿ´","ÿ´","ÿ®","ÿ™","ÿ®","ÿ´","ÿ™","ÿ™","ÿ®"
];
const band12Data = ["ÿ´","ÿ™","ÿ®","ÿß"
];

/* RENDER */

function renderLine(id, data){

  const box = document.getElementById(id);

  box.innerHTML = "";

  data.slice().reverse().forEach(letter=>{

    const wrap = document.createElement("div");
    wrap.className = "letter";

    const base = document.createElement("span");
    base.className = "base";
    base.textContent = letter;

    const haraka = document.createElement("span");
    haraka.className = "haraka";
    haraka.textContent = "Ÿé";

    wrap.appendChild(base);
    wrap.appendChild(haraka);

    box.appendChild(wrap);

  });
}


/* INIT */


/* Affichage */
renderLine("band1", band1Data);
renderLine("band2", band2Data);
renderLine("band3", band3Data);
renderLine("band4", band4Data);
renderLine("band5", band5Data);
renderLine("band6", band6Data);
renderLine("band7", band7Data);
renderLine("band8", band8Data);
renderLine("band9", band9Data);
renderLine("band10", band10Data);
renderLine("band11", band11Data);
renderLine("band12", band12Data);


/* STOP */

function stop(){

  audio.pause();
  audio.currentTime = 0;

  if(timer){
    clearTimeout(timer);
    timer = null;
  }

  document.querySelectorAll(".letter")
    .forEach(l=>l.classList.remove("active"));

  if(currentButton){
    currentButton.textContent = "‚ñ∂";
  }

  isPlaying = false;
  currentButton = null;
}


/* TOGGLE PLAY */

function togglePlay(containerId, btn){

  if(isPlaying && currentButton === btn){

    audio.pause();
    btn.textContent = "‚ñ∂";
    isPlaying = false;
    return;
  }

  stop();

  currentButton = btn;
  btn.textContent = "‚è∏";
  isPlaying = true;

  playLine(containerId);
}


/* PLAY */

function playLine(containerId){

  const letters =
    document.getElementById(containerId)
    .querySelectorAll(".letter");

  let i = 0;

  function playNext(){

    if(!isPlaying || i >= letters.length){

      if(currentButton){
        currentButton.textContent = "‚ñ∂";
      }

      isPlaying = false;
      return;
    }

    document
      .querySelectorAll(".letter")
      .forEach(l=>l.classList.remove("active"));

    const current = letters[i];
    const base = current.querySelector(".base").textContent;

    current.classList.add("active");

    const data = sounds[base];

    audio.currentTime = data.start;
    audio.play();

    const duration = (data.d + 0.15) * 1000;

    timer = setTimeout(()=>{

      audio.pause();
      current.classList.remove("active");

      i++;

      timer = setTimeout(playNext, 300);

    }, duration);
  }

  playNext();
}

</script>

</body>
</html>